{{extend 'layout.html'}}
<table>
	<tr>
		<td></td>
		<td>
			<ul class="editor_menu">
				{{if not request.vars.html5only:}}
				<li id="save_to_session"> 
				<div>save current network to session</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'disk.png')}}"/> 
				&nbsp;
				</li>
				{{pass}}
				<li id="clear"> 
				<div>clear the canvas</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'trash.png')}}"/> 
				&nbsp;
				</li>
				<!-- ---------------------------------------------------------------- -->
				{{if not request.vars.html5only:}}
				<li class="spacer"></li>
                <li id="bug" {{="class=fkt_active" if session.debug else ""}}> 
				<div>switch to debug mode</div>
                <a href="{{=URL('debug')}}"><img src="{{=URL(request.application, 'static/biographer-editor/img', 'bug.png')}}"/></a>
				&nbsp;
				</li>
				<li id="reset"> 
				<div>reset biographer</div>
                <a href="{{=URL('reset')}}"><img src="{{=URL(request.application, 'static/biographer-editor/img', 'reset.png')}}"/></a>
				&nbsp;
				</li>
				<!-- ---------------------------------------------------------------- -->
				{{pass}}
				<li class="spacer"></li>
				<li id="undo"> 
				<div>undo</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'undo.png')}}"/> 
				&nbsp;
				</li>
				<li id="redo"> 
				<div>redo</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'redo.png')}}"/> 
				&nbsp;
				</li>
				<!-- ---------------------------------------------------------------- -->
				<li class="spacer"></li>
				<li id="import_file"> 
				<div><b>import</b> graph from : JSON file, SBML file, BioModels.net, Reactome </div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'import_file.png')}}"/> 
				&nbsp;
				</li>
				<li id="import_str"> 
				<div><b>import</b> JSON graph <b>from string</b></div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'import_string.png')}}"/> 
				&nbsp;
				</li>
				<li class="spacer"></li>
				<li id="export_json"> 
				<div>export current graph as jSBGN (JSON)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'export_json.png')}}"/> 
				&nbsp;
				</li>
			    	{{if not request.vars.html5only:}}
				<li id="export_svg"> 
				<div>export current graph as SVG</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'export_svg.png')}}"/> 
				&nbsp;
				</li>
				</li>
				<li id="export_other"> 
				<div>export current graph as: png,jpeg,pdf,tiff</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'export.png')}}"/> 
				&nbsp;
				</li>
				{{pass}}
				<!-- ---------------------------------------------------------------- -->
				<li class="spacer"></li>
				<li id="layout_grid"> 
				<div>apply <b>grid based</b> layout in browser (if ctrl+click the grid is only initialized)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'grid.png')}}"/> 
				&nbsp;
				</li>
				<li id="layout_force"> 
				<div>apply <b>D3 force based</b> layout in browser</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'd3_force.png')}}"/> 	
				&nbsp;
				</li>
				{{if not request.vars.html5only:}}
				<li id="layout_biographer"> 
				<div>apply automatic <b>biographer</b> layout</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'biographer.png')}}"/> 
				&nbsp;
				</li>
				{{pass}}
				<li id="clone"> 
				<div>clone selected objects (or all) with with edge degree &gt; 5</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'clone.png')}}"/> 
				&nbsp;
				</li>
				<li id="combine"> 
				<div>combine selected objects</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'combine.png')}}"/> 
				&nbsp;
				</li>
				<li id='straighten_and_distribute' class="fkt_active"> 
				<div>enable/disable: straighten edges and distributen all points on edges equally</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'straighten_and_distribute.png')}}"/> 
				&nbsp;
				</li>
				<li id='hide_handles'> 
				<div>hide/show all edge handles</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'hide_handle.png')}}"/> 
				&nbsp;
				</li>
				<!-- li id="layout_grahviz"> 
				<div>apply automatic <b>graphviz</b> layout</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'graphviz.png')}}"/> 
				&nbsp;
				</li -->
				<!-- ---------------------------------------------------------------- -->
				<li class="spacer"></li>
				<li class="scale" data-rate='0.1'> 
				<div>zoom in</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'zoom_in.png')}}"/> 
				&nbsp;
				</li>
				<li class="scale" data-rate='-0.1'> 
				<div>zoom out</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'zoom_out.png')}}"/> 
				&nbsp;
				</li>
				<li id='scale1'> 
				<div>scale to default size</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'one.png')}}"/> 
				&nbsp;
				</li>
				<li id="fit_to_screen"> 
				<div>fit to page</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'fit_to_screen.png')}}"/> 
				&nbsp;
				</li>
				<!-- ---------------------------------------------------------------- -->
				<li class="spacer"></li>
				<li id='edit_all_nodes'> 
				<div>resize/move all nodes</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'select_all.png')}}"/> 
				&nbsp;
				</li>
				<li id='edit_no_nodes'> 
				<div>resize/move no nodes</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'select_none.png')}}"/> 
				&nbsp;
				</li>
				<!-- ---------------------------------------------------------------- -->
				<li class="spacer"></li>
				<li id='align_vertical'> 
				<div>align selected nodes vertically</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'align_vertical.png')}}"/> 
				&nbsp;
				</li>
				<li id='align_hoizontal'> 
				<div>align selected nodes horizontally</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'align_hoizontal.png')}}"/> 
				&nbsp;
				</li>
				<li id='align_left'> 
				<div>align selected nodes left</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'align_left.png')}}"/> 
				&nbsp;
				</li>
				<li id='align_top'> 
				<div>align selected nodes top</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'align_top.png')}}"/> 
				&nbsp;
				</li>
				<li id='align_right'> 
				<div>align selected nodes right</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'align_right.png')}}"/> 
				&nbsp;
				</li>
				</li>
				<li id='align_bottom'> 
				<div>align selected nodes bottom</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'align_bottom.png')}}"/> 
				&nbsp;
				</li>
				<li id='horizontal_gaps_equal'> 
				<div>make the distances of horizontal gaps between nodes equal</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'horizontal_gaps_equal.png')}}"/> 
				&nbsp;
				</li>
				<li id='vertical_gaps_equal'> 
				<div>make the distances of vertical gaps between nodes equal</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'vertical_gaps_equal.png')}}"/> 
				&nbsp;
				</li>
				</li>
				<!-- ---------------------------------------------------------------- -->
				<li class="spacer"></li>
				<li id='help'> 
				<div>help
                    Biographer currently works best with Chromium (Chrome), while FireFox also works it is very slow in working with lager graphs. Opera currently does not render the line ends properly.
					<table>
						<tr>
							<th>ctrl+click</th>
							<td>select an element to edit (resize, move, align)</td>
						</tr>
						<tr>
							<th>doubleclick</th>
							<td>deselect all nodes (for editing)</td>
						</tr>
					</table>
					yes the help is a bit sparse, contact us if you need further help
				</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'help.png')}}"/> 
				&nbsp;
				</li>
			</ul>
		</td>
	</tr>
	<tr>
		<td>
			<ul class="tools_group tools_click">
				<li class="active" id='cursor'>
				<div>select<br />ctrl+click to move and resize</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'cursor.png')}}" id="cursor" class="tool"/>
				</li>
				<li id='move'>
				<div>move selected items</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'move.png')}}" id="move" class="tool"/>
				</li>
				<li id='selection'>
				<div>click to start drawing selection rectangle, click again to finish selection</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'selection.png')}}" id="selection" class="tool"/>
				</li>
				<li id='edit'>
				<div>edit</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'wrench.png')}}" id="edit" class="tool"/>
				</li>
				<li id='Edge'>
				<div>draw edge</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'edge.png')}}" id="Edge" class="tool"/>
				</li>
				<li id='Spline'>
				<div>draw spline</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'spline.png')}}" id="Spline" class="tool"/>
				</li>
				<li id='del'>
				<div>delete node</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'cross.png')}}" id="cross" class="tool"/>
				</li>
				<li id="focus"> 
				<div>focus to node</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'focus.png')}}"/> 
				&nbsp;
				</li>
			</ul>
			<ul class="tools_group tools_drag">
				<li>
				<div>SimpleChemical (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'SimpleChemical.png')}}" id="SimpleChemical" class="tool node PD"/>
				</li>
				<li>
				<div>Macromolecule (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Macromolecule.png')}}" id="Macromolecule" class="tool node PD ER"/>
				</li>
				<li>
				<div>NucleicAcidFeature (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'NucleicAcidFeature.png')}}" id="NucleicAcidFeature" class="tool node PD"/>
				</li>
				<li>
				<div>UnspecifiedEntity (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'UnspecifiedEntity.png')}}" id="UnspecifiedEntity" class="tool node PD"/>
				</li>
				<li>
				<div>Entity (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'RectangularNode.png')}}" id="RectangularNode" class="tool node ER AF"/>
				</li>
				<li>
				<div>Perturbation (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Perturbation.png')}}" id="Perturbation" class="tool node PD ER"/>
				</li>
				<li>
				<div>Phenotype (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Phenotype.png')}}" id="Phenotype" class="tool node PD ER"/>
				</li>
				<li>
				<div>Compartment (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Compartment.png')}}" id="Compartment" class="tool node no_drop_complex PD"/>
				</li>
				<li>
				<div>Complex (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Complex.png')}}" id="Complex" class="tool node PD"/>
				</li>
				<li>
				<div>EmptySet (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'EmptySet.png')}}" id="EmptySet" class="tool node PD"/>
				</li>
				<li>
				<div>Process (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Process.png')}}" id="Process" class="tool node no_drop_complex PD"/>
				</li>
				<li>
				<div>Tag (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Tag.png')}}" id="Tag" class="tool node PD"/>
				</li>
				<li>
				<div>LogicalOperator (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'LogicalOperator.png')}}" id="LogicalOperator" class="tool node PD ER"/>
				</li>
				<li>
				<div>Association (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Association.png')}}" id="Association" class="tool node PD"/>
				</li>
				<li>
				<div>Dissociation (drag me)</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'Dissociation.png')}}" id="Dissociation" class="tool node PD"/>
				</li>
			</ul>
		</td>
		<td>
			<div id="spacer"></div>
			<div id="outer_canvas">
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'move.png')}}" id="follow_move" class='follow' style="position: fixed;"/>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'selection.png')}}" id="follow_selection" class='follow' style="position: fixed;"/>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'cross.png')}}" id="follow_cross" class='follow' style="position: fixed;"/>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'wrench.png')}}" id="follow_wrench" class='follow' style="position: fixed;"/>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'edge.png')}}" id="follow_edge" class='follow' style="position: fixed;"/>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'spline.png')}}" id="follow_spline" class='follow' style="position: fixed;"/>
				<img src="{{=URL(request.application, 'static/biographer-editor/img', 'focus_.png')}}" id="follow_focus" class='follow' style="position: fixed;"/>
				<div id="canvas" class='droppable'></div>
			</div>
		</td>
	</tr>
</table>
<div class="selection_rect"></div>
<!-- --------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------- -->
<form action="{{=URL('export')}}" id='export_form' style='display: none;' method="POST"></form>
<!-- --------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------- -->
<div id="import_file_modal_input" class="modal_input">
		<table>
			<tr>
				<th> JSON / SBML / SBGN-ML File </th>
                <td>
                    <form id='import_form' method="post" enctype="multipart/form-data">
                        <input name="import_file" type="file" id="import_file_input"/>
                    </form>
                </td>
			</tr>
			<tr>
                <th> <a href="http://www.reactome.org/">Reactome</a></th>
                <td>                     
                    <form id='import_re' method="post" enctype="multipart/form-data">
                        <select name="reactome_id" id="reactome_id" width="20">
                            {{include 'default/reactome_pathways.html'}}
                        </select>
                        <button id="reactome">load</button>
                    </form>
                </td>
			</tr>
			<tr>
                <th> <a href="http://www.ebi.ac.uk/biomodels-main/"> BioModels.net </th> </a> <td>
                	{{include 'default/biomodels_info.html'}}
                </td>
			</tr>
		</table>
		<br />
		<br />
		<button class='sc_but' id='cancel_modal_input'>cancel</button> or press <b>ESC</b>
</div>
<!-- --------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------- -->
<div id="import_string_modal_input" class="modal_input">
	<textarea cols="30" rows="10" id='json_string' >{"nodes":[{"id":"node0","visible":true,"sbo":240,"data":{"x":50,"y":53,"width":61,"height":61,"label":"ATP"}}],"edges":[]}</textarea>
	<br />
	<button class='sc_but' id='load_json_string'>load</button> or press <b>ENTER</b>
	<br />
	<button class='sc_but' id='cancel_node_modal_input'>cancel</button> or press <b>ESC</b>
</div>
<!-- --------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------- -->
<div id="node_modal_input" class="modal_input">
	<table>
		<tr id="node_label_row">
			<th>Label</th>
			<td> <input type="text" placeholder="ATP" id='node_label' /></td>
		</tr>
		<tr>
			<th>Unit of Information</th>
			<td> 
				<div id="uoi_group">
					<input type="text" placeholder="mt:prot" class='unit_of_information' /> 
				</div>
				<img src="{{=URL(request.application, 'static/biographer-editor/img/ico', 'add.png')}}" id="add_unit_of_information" title="add another Unit of Information"/>
			</td>
		</tr>
		<tr>
			<th>Color</th>
			<td> 
				<div class="colorbox"><input type="radio" name="node_color" value="none" checked/></div>
				<div class="colorbox Silver"><input type="radio" name="node_color" value="Silver"/></div>
				<div class="colorbox Gray"><input type="radio" name="node_color" value="Gray"/></div>
				<div class="colorbox Red"><input type="radio" name="node_color" value="Red"/></div>
				<div class="colorbox Maroon"><input type="radio" name="node_color" value="Maroon"/></div>
				<div class="colorbox Yellow"><input type="radio" name="node_color" value="Yellow"/></div>
				<div class="colorbox Olive"><input type="radio" name="node_color" value="Olive"/></div>
				<div class="colorbox Lime"><input type="radio" name="node_color" value="Lime"/></div>
				<br />
				<div class="colorbox Green"><input type="radio" name="node_color" value="Green"/></div>
				<div class="colorbox Aqua"><input type="radio" name="node_color" value="Aqua"/></div>
				<div class="colorbox Teal"><input type="radio" name="node_color" value="Teal"/></div>
				<div class="colorbox Blue"><input type="radio" name="node_color" value="Blue"/></div>
				<div class="colorbox Navy"><input type="radio" name="node_color" value="Navy"/></div>
				<div class="colorbox Fuchsia"><input type="radio" name="node_color" value="Fuchsia"/></div>
				<div class="colorbox Purple"><input type="radio" name="node_color" value="Purple"/></div>
			</td>
		</tr>
	</table>
	<button class='sc_but' id='close_modal_input'>close</button> or press <b>ESC</b> or <b>ENTER</b>
	</div>
</div>
<!-- --------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------- -->
<!-- storage for modals -->
	<div class="current_id" style="display: none"/>
	<div id='action' style="display: none"></div>
	<div id='marker_type' style="display: none"></div>
<!-- --------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------- -->
<div id="edge_modal_input" class="modal_input">
	<table>
		<tr>
			<th>End Marker</th>
			<td>
				<div id="marker_select">
					<div class="marker_select" id="">
						<div> none </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'slide_down.png')}}"/> 
					</div>
					<div class="marker_select" id="production">
						<div> production </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'production.png')}}"/> 
					</div>
					<div class="marker_select" id="control">
						<div> control </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'control.png')}}"/> 
					</div>
					<div class="marker_select" id="inhibition">
						<div> inhibition </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'inhibition.png')}}"/> 
					</div>
					<div class="marker_select" id="catalysis">
						<div> catalysis </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'catalysis.png')}}"/> 
					</div>
					<div class="marker_select" id="stimulation">
						<div> stimulation </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'stimulation.png')}}"/> 
					</div>
					<div class="marker_select" id="assignment">
						<div> assignment </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'assignment.png')}}"/> 
					</div>
					<div class="marker_select" id="necessaryStimulation">
						<div> necessaryStimulation </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'necessaryStimulation.png')}}"/> </div>
					<div class="marker_select" id="absoluteStimulation">
						<div> absoluteStimulation </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'absoluteStimulation.png')}}"/> </div>
					<div class="marker_select" id="absoluteInhibition">
						<div> absoluteInhibition </div>
						<img src="{{=URL(request.application, 'static/biographer-editor/img', 'absoluteInhibition.png')}}"/> </div>
				</div>
			</td>
		</tr>
	</table>
	<button class='sc_but' id='close_modal_input'>close</button> or press <b>ESC</b>
	</div>
</div>
<!-- --------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------- -->
<div id="export_file_modal_input" class="modal_input">
	<table>
		<tr>
			<th>Choose Export Format</th>
			<td>
				<select id="export_format_select">
					<option value="">... choose</option>
					{{for frmt in 'png pdf tiff'.split():}} <option>{{=frmt}}</option> {{pass}}
				</select>
			</td>
		</tr>
	</table>
	<br />
	<br />
	<button class='sc_but' id='cancel_modal_input'>cancel</button> or press <b>ESC</b>
</div>
<!-- --------------------------------------------------------------------------------- -->
{{if session.debug:}}
<script type="text/javascript">
    {{include 'default/biographer-ui.js'}}
</script>
{{else:}}
<script type="text/javascript" src="{{=URL(request.application, 'static/biographer-editor/js', 'biographer-ui.js')}}"></script>
{{pass}}
<script type="text/javascript" src='{{=URL(request.application, 'static/biographer-editor/js', 'biographer.editor.js')}}'></script>
<script type="text/javascript" src='{{=URL(request.application, 'static/biographer-editor/js', 'interact.js')}}'></script>
<script type="text/javascript" src='{{=URL(request.application, 'static/biographer-editor/js', 'libSBGN.js')}}'></script>
<!-- --------------------------------------------------------------------------------- -->
<script type="text/javascript">
editor_config = {
	url_undo_push : '{{=URL("undo_push")}}',
	url_undo : '{{=URL('undo.json')}}',
	url_redo : '{{=URL('redo.json')}}',
	url_layout : 'http://cheetah.biologie.hu-berlin.de/layouter',
	url_import : '{{=URL('import_graph')}}',
 	graphData: {{if session.editor_autosave:}} {{=XML(session.editor_autosave)}} {{else:}} {
    		nodes : [],
    		edges : []
    	}{{pass}},
    history_redo:  [],
    history_undo:  []
}
//=========================
editor = new Editor();
bui.ready(function() {
	//bui.settings.css.stylesheetUrl = '{{=URL(request.application, "static/biographer-editor/css", "visualization-svg.css")}}';//FIXME this is not working anymore
	editor.graph = new bui.Graph($('#canvas')[0]);
	//bui.Node.bindStatic(bui.Node.ListenerType.click, editor.drawableSelect());//FIXME this does not work, y?
	editor.redrawGraph(editor_config.graphData);
	
});
</script>
